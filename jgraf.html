<html>
  <head>
    <title>jgraf test</title>
    <script src="/js/jgraf.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="datainput"></div><br/>
    <input type="button" value="Add Value" id="addvaluebtn" />
    <input type="button" value="Redraw Graphs" id="redrawgraphs" /><br/>
    <table style="border-width:0px;"><tr>
      <td>
        <div id="bargraph"></div>
        <label for="barcolors">Bar Colors (use rgb(r,g,b) defintions comma delimited)</label><textarea id="barcolors"></textarea><br/>
        <label for="barheight">Height</label><input type="text" id="barheight" /><br/>
        <label for="barwidth">Width</label><input type="text" id="barwidth" /><br/>
        <label for="bargraphcolor">Graph Color (use rgb(r,g,b) format)</label><input type="text" id="bargraphcolor" /><br/>
        <label for="barxlabel">X Label</label><input type="text" id="barxlabel" /><br/>
        <label for="barylabel">Y Label</label><input type="text" id="barylabel" /><br/>
        <input type="button" id="redrawbar" value="Redraw Bar Graph" />
      </td>
      <td style="width:100px;"></td>
      <td>
        <div id="linegraph"></div>
        <label for="linecolor">Line color (use rgb(r,g,b) format)</label><input type="text" id="linecolor" /><br/>
        <label for="linedotcolor">Dot color (use rgb(r,g,b) format)</label><input type="text" id="linedotcolor" /><br/>
        <label for="lineheight">Height</label><input type="text" id="lineheight" /><br/>
        <label for="linewidth">Width</label><input type="text" id="linewidth" /><br/>
        <label for="linegraphcolor">Graph Color (use rgb(r,g,b) format)</label><input type="text" id="linegraphcolor" /><br/>
        <label for="linexlabel">X Label</label><input type="text" id="linexlabel" /><br/>
        <label for="lineylabel">Y Label</label><input type="text" id="lineylabel" /><br/>
        <input type="button" id="redrawline" value="Redraw Line Graph" />
      </td>
    </tr></table>
    <script type="text/javascript">
      var rowCount = 0;
      var data = [];
      var barGraph = null;
      var lineGraph = null;
      
      document.body.onload = function() {
        document.getElementById('redrawbar').onclick = function() {
          barGraph.setColors(document.getElementById('barcolors').value.split('\n'));
          barGraph.setHeight(parseInt(document.getElementById('barheight').value));
          barGraph.setWidth(parseInt(document.getElementById('barwidth').value));
          barGraph.setGraphColor(document.getElementById('bargraphcolor').value);
          barGraph.setXLabel(document.getElementById('barxlabel').value);
          barGraph.setYLabel(document.getElementById('barylabel').value);
          
          document.getElementById('redrawgraphs').click();          
        };
        
        document.getElementById('redrawbar').onclick = function() {
          lineGraph.setLineColor(document.getElementById('linecolor').value);
          lineGraph.setDotColor(document.getElementById('linedotcolor').value);
          lineGraph.setHeight(parseInt(document.getElementById('lineheight').value));
          lineGraph.setWidth(parseInt(document.getElementById('linewidth').value));
          lineGraph.setGraphColor(document.getElementById('linegraphcolor').value);
          lineGraph.setXLabel(document.getElementById('linexlabel').value);
          lineGraph.setYLabel(document.getElementById('lineylabel').value);
          
          document.getElementById('redrawgraphs').click();          
        };
        
        document.getElementById('redrawgraphs').onclick = function() {
          var labels = Array.prototype.slice.call(document.getElementsByClassName('glabel'));
          var values = Array.prototype.slice.call(document.getElementsByClassName('gvalue'));
        
          if (labels.length == values.length) {
            data = [];
            for (var i = 0; i < labels.length; i++) {
              if (values[i].value.toString().length == 0 || values[i].value.toString().length == 0) continue;
              data.push({v:parseFloat(values[i].value),l:labels[i].value});
            }
            
            lineGraph.setData(data);
            document.getElementById('linegraph').innerHTML = lineGraph.render();
            
            barGraph.setData(data);
            document.getElementById('bargraph').innerHTML = barGraph.render();
            
            localStorage.graph_data = JSON.stringify(data);
          }
        };
        
        document.getElementById('addvaluebtn').onclick = function() {
          var lValue = document.createElement('input');
          lValue.setAttribute('type','text');
          lValue.setAttribute('class','glabel');
          lValue.setAttribute('id','row' + rowCount.toString() + '_label');
        
          var lLabel = document.createElement('label');
          lLabel.setAttribute('for','row' + rowCount.toString() + '_label');
          lLabel.innerHTML = 'Label';
        
          var vValue = document.createElement('input');
          vValue.setAttribute('type','text');
          vValue.setAttribute('class','gvalue');
          vValue.setAttribute('id','row' + rowCount.toString() + '_value');
        
          var vLabel = document.createElement('label');
          vLabel.setAttribute('for','row' + rowCount.toString() + '_value');
          vLabel.innerHTML = 'Value';
        
          document.getElementById('datainput').appendChild(lLabel);
          document.getElementById('datainput').appendChild(lValue);
          document.getElementById('datainput').appendChild(vLabel);
          document.getElementById('datainput').appendChild(vValue);
          document.getElementById('datainput').appendChild(document.createElement('br'));
          
          rowCount++;
        };
        
        if (!localStorage.graph_data) {
          localStorage.graph_data = "[{\"v\":100,\"l\":\"Value\"}]";
        }
        
        data = JSON.parse(localStorage.graph_data);
        
        data.forEach((v,i) => {
          document.getElementById('addvaluebtn').click();
          document.getElementsByClassName('glabel')[i].value = data[i].l;
          document.getElementsByClassName('gvalue')[i].value = data[i].v.toString();
        });
        
        barGraph = new JGrafBar(300,300,30,'Labels','Test Data Bar Graph',['rgb(255,0,0)','rgb(0,255,0)','rgb(0,0,255)'],data,'rgb(0,0,255)');
        lineGraph = new JGrafLine(300,300,30,'Labels','Test Line Graph','rgb(255,0,0)','rgb(0,0,255)',data,'rgb(0,255,0)');
        
        document.getElementById('linegraph').innerHTML = lineGraph.render();
        document.getElementById('bargraph').innerHTML = barGraph.render();
      };
    </script>
  </body>
</html>
