<html>
  <head>
    <title>jgraf test</title>
    <script src="/js/jgraf.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="datainput"></div><br/>
    <input type="button" value="Add Value" id="addvaluebtn" />
    <input type="button" value="Redraw Graphs" id="redrawgraphs" /><br/>
    <table style="border-width:0px;"><tr>
      <td id="bargraph"></td>
      <td style="width:100px;"></td>
      <td id="linegraph"></td>
    </tr></table>
    <script type="text/javascript">
      var rowCount = 0;
      var data = [];
      var barGraph = null;
      var lineGraph = null;
      
      document.body.onload = function() {
        document.getElementById('redrawgraphs').onclick = function() {
          var labels = Array.prototype.slice.call(document.getElementsByClassName('glabel'));
          var values = Array.prototype.slice.call(document.getElementsByClassName('gvalue'));
        
          if (labels.length == values.length) {
            data = [];
            for (var i = 0; i < labels.length; i++) {
              if (values[i].value.toString().length == 0 || values[i].value.toString().length == 0) continue;
              data.push({v:parseFloat(values[i].value),l:labels[i].value});
            }
            
            lineGraph.setData(data);
            document.getElementById('linegraph').innerHTML = lineGraph.render();
            
            barGraph.setData(data);
            document.getElementById('bargraph').innerHTML = barGraph.render();
            
            localStorage.graph_data = JSON.stringify(data);
          }
        };
        
        document.getElementById('addvaluebtn').onclick = function() {
          var lValue = document.createElement('input');
          lValue.setAttribute('type','text');
          lValue.setAttribute('class','glabel');
          lValue.setAttribute('id','row' + rowCount.toString() + '_label');
        
          var lLabel = document.createElement('label');
          lLabel.setAttribute('for','row' + rowCount.toString() + '_label');
          lLabel.innerHTML = 'Label';
        
          var vValue = document.createElement('input');
          vValue.setAttribute('type','text');
          vValue.setAttribute('class','gvalue');
          vValue.setAttribute('id','row' + rowCount.toString() + '_value');
        
          var vLabel = document.createElement('label');
          vLabel.setAttribute('for','row' + rowCount.toString() + '_value');
          vLabel.innerHTML = 'Value';
        
          document.getElementById('datainput').appendChild(lLabel);
          document.getElementById('datainput').appendChild(lValue);
          document.getElementById('datainput').appendChild(vLabel);
          document.getElementById('datainput').appendChild(vValue);
          document.getElementById('datainput').appendChild(document.createElement('br'));
          
          rowCount++;
        };
        
        if (!localStorage.graph_data) {
          localStorage.graph_data = "[{\"v\":100,\"l\":\"Value\"}]";
        }
        
        data = JSON.parse(localStorage.graph_data);
        
        data.forEach((v,i) => {
          document.getElementById('addvaluebtn').click();
          document.getElementsByClassName('glabel')[i].value = data[i].l;
          document.getElementsByClassName('gvalue')[i].value = data[i].v.toString();
        });
        
        barGraph = new JGrafBar(300,300,30,'Labels','Test Data Bar Graph',['rgb(255,0,0)','rgb(0,255,0)','rgb(0,0,255)'],data,'rgb(0,0,255)');
        lineGraph = new JGrafLine(300,300,30,'Labels','Test Line Graph','rgb(255,0,0)','rgb(0,0,255)',data,'rgb(0,255,0)');
        
        document.getElementById('linegraph').innerHTML = lineGraph.render();
        document.getElementById('bargraph').innerHTML = barGraph.render();
      };
    </script>
  </body>
</html>
