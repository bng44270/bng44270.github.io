<html>
  <head>
    <title>Leaflet test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <script type="text/javascript">
      var map = null;
      
      function mapInit() {
        var map = L.map('map');
        map.options.nextMarkerId = 0;
        map.options.isMovingMarker = false;
        map.options.markerMove = -1;
        
        map.on('click',function(e) {
	        if (map.options.isMovingMarker) {
  		      moveMarker(map.options.markerMove,e.latlng);
  	      }
  	      else {
  		      var info = prompt("Enter point info");
  		      if (info) {
        			createMarker(e.latlng,info);
        		}
  	      }
        });
      }   
      
      function updateView() {
        var lat = parseFloat(document.getElementById('lat_box').value);
        var lng = parseFloat(document.getElementById('lng_box').value);
        var zoom = parseInt(document.getElementById('zoom_box').value);
        
        map.setView([lat,lng],zoom);
      }
      
      //Render popup text
      function createMarker(loc,text) {
	      thisId = map.options.nextMarkerId++;
      
	      var deleteLink = document.createElement('a');
	      deleteLink.innerText = 'Delete';
	      deleteLink.setAttribute('style','cursor:pointer;');
	      deleteLink.setAttribute('onClick','javascript:deleteMarker(' + thisId + ');');
      
	      var editLink = document.createElement('a');
	      editLink.innerText = 'Edit';
	      editLink.setAttribute('style','cursor:pointer;');
	      editLink.setAttribute('onClick','javascript:editMarker(' + thisId + ');');
      	
	      var moveLink = document.createElement('a');
	      moveLink.innerText = 'Move';
	      moveLink.setAttribute('style','cursor:pointer;');
      	moveLink.setAttribute('onClick','javascript:moveMarker(' + thisId + ');');
      
	      L.marker(loc,{
		      info : text,
		      id : thisId
	      }).addTo(map).bindPopup(text + '<br/>[' + editLink.outerHTML + '] [' + moveLink.outerHTML + '] [' + deleteLink.outerHTML  + ']');
      
      	
      }
      
      //Move marker where options.id = id
      function moveMarker(id,newLatLng) {
	      if (!map.options.isMovingMarker && !newLatLng) {
		      map.closePopup();
		      map.options.isMovingMarker = true;
		      map.options.markerMove = id;
	      }
	      else {
		      var layerIds = Object.keys(map._layers);
		      for (var i = 0; i < layerIds.length; i++) {
			      if (map._layers[layerIds[i]].options.id == id) {
				      var text = map._layers[layerIds[i]].options.info;
				      deleteMarker(id);
				      createMarker(newLatLng,text);
				      map.options.isMovingMarker = false;
				      map.options.markerMove = -1;
				      break;
			      }
		      }
	      }
      }
      
      //Delete marker where options.id = id
      function deleteMarker(id) {
	      var layerIds = Object.keys(map._layers);
	      for (var i = 0; i < layerIds.length; i++) {
		      if (map._layers[layerIds[i]].options.id == id) {
			      map.removeLayer(map._layers[layerIds[i]]);
			      break;
		      }
	      }
      }
      
      //Edit marker where options.id = id
      function editMarker(id) {
	      map.closePopup();
	      var layerIds = Object.keys(map._layers);
	      for (var i = 0; i < layerIds.length; i++) {
		      if (map._layers[layerIds[i]].options.id == id) {
			      var text = map._layers[layerIds[i]].options.info;
			      var latlng = map._layers[layerIds[i]]._latlng;
      			var newText = prompt('Enter item info',text);
      			
      			if (newText) {
      				deleteMarker(id);
      				createMarker(latlng,newText);
      			}
      			
      			break;
		      }
	      }
      }
    </script>
  </head>
  <body onLoad="mapInit();">
    Lat<input type="text" id="lat_box" onKeyUp="updateView();" /><br/>
    Lng<input type="text" id="lng_box" onKeyUp="updateView();" /><br/>
    Zoom<select id="zoom_box" onChange="updateView();"><option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12">12</option>
<option value="13">13</option>
    </select><br/>
    <div id="map" style="width:500px;height:500px;"></div>
  </body>
</html>
